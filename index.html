<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LimitlessPix AI v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'shine': 'shine 3s linear infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        shine: {
                            '0%': { backgroundPosition: '200% center' },
                            '100%': { backgroundPosition: '-200% center' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap');

        /* Base Styles & Scrollbar */
        body {
            font-family: 'Outfit', sans-serif;
            overflow: hidden; /* Prevent body scroll, handle in app container */
        }
        
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Custom Scrollbar for Gallery */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        /* Neon & Glass Effects */
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .dark .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .neon-button {
            background: linear-gradient(90deg, #0ea5e9, #8b5cf6, #ec4899);
            background-size: 200% 200%;
            animation: gradient-shift 3s ease infinite;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Shining Text Animation for Developer Name */
        .shiny-text {
            background: linear-gradient(to right, #4d4d4d 0%, #fff 50%, #4d4d4d 100%);
            background-size: 200% auto;
            color: #000;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 3s linear infinite;
            font-weight: 800;
        }
        .dark .shiny-text {
            background: linear-gradient(to right, #22d3ee 0%, #ffffff 50%, #22d3ee 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Complex Loader Styles */
        .loader-container {
            position: fixed;
            inset: 0;
            background: #020617;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.8s ease-out, visibility 0.8s;
        }
        
        .scanner {
            position: relative;
            width: 200px;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .ring {
            position: absolute;
            border-radius: 50%;
            border: 2px solid transparent;
            border-top-color: #0ea5e9;
            border-bottom-color: #ec4899;
        }
        
        .r1 { width: 100%; height: 100%; animation: spin 2s linear infinite; }
        .r2 { width: 80%; height: 80%; border-top-color: #8b5cf6; border-bottom-color: #10b981; animation: spin 3s linear infinite reverse; }
        .r3 { width: 60%; height: 60%; border-top-color: #f59e0b; border-bottom-color: #ef4444; animation: spin 1.5s linear infinite; }
        
        .core {
            width: 40px;
            height: 40px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 20px #fff, 0 0 40px #0ea5e9;
            animation: pulse 1s ease-in-out infinite;
        }

        /* Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #68D391;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #68D391;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-[#050510] transition-colors duration-300 flex items-center justify-center h-screen w-screen m-0">

    <!-- COMPLEX INITIAL LOADER -->
    <div id="initialLoader" class="loader-container">
        <div class="flex flex-col items-center gap-8">
            <div class="scanner">
                <div class="ring r1"></div>
                <div class="ring r2"></div>
                <div class="ring r3"></div>
                <div class="core"></div>
            </div>
            <div class="text-center">
                <h2 class="text-2xl font-bold text-white tracking-[0.5em] mb-2 animate-pulse">INITIALIZING</h2>
                <p class="text-cyan-400 text-xs font-mono" id="loaderText">Loading Neural Networks...</p>
            </div>
        </div>
    </div>

    <!-- MAIN APP CONTAINER -->
    <!-- MD: Fixed size frame. SM: Full screen. -->
    <div class="w-full h-full md:max-w-[420px] md:h-[90vh] md:rounded-[3rem] bg-white dark:bg-[#0a0a16] relative overflow-hidden flex flex-col shadow-2xl md:border-[8px] md:border-slate-800 md:ring-1 md:ring-white/10 transition-all duration-300">
        
        <!-- Dynamic Dynamic Island / Notch -->
        <div class="hidden md:block absolute top-0 left-1/2 transform -translate-x-1/2 w-32 h-7 bg-black rounded-b-2xl z-50"></div>

        <!-- APP HEADER -->
        <div class="pt-8 md:pt-12 pb-4 px-6 flex justify-between items-center z-20 bg-white/80 dark:bg-[#0a0a16]/80 backdrop-blur-md sticky top-0">
            <div class="flex items-center gap-2">
                <div class="relative w-8 h-8 flex items-center justify-center">
                    <i class="fas fa-infinity text-xl text-cyan-400 absolute animate-pulse"></i>
                </div>
                <h1 class="text-lg font-bold tracking-wide text-gray-800 dark:text-white">
                    Limitless<span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">Pix</span>
                </h1>
            </div>
            <button onclick="toggleMenu()" class="text-gray-600 dark:text-gray-300 hover:text-cyan-500 transition-colors">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>

        <!-- SLIDE-OUT MENU OVERLAY -->
        <div id="menuOverlay" class="absolute inset-0 bg-black/50 z-40 hidden opacity-0 transition-opacity duration-300 backdrop-blur-sm" onclick="toggleMenu()"></div>
        
        <!-- SIDE MENU -->
        <div id="sideMenu" class="absolute top-0 right-0 h-full w-3/4 bg-white dark:bg-[#11111f] z-50 transform translate-x-full transition-transform duration-300 shadow-2xl flex flex-col">
            <div class="p-6 flex justify-between items-center border-b border-gray-200 dark:border-gray-800">
                <h2 class="font-bold text-xl dark:text-white">Settings</h2>
                <button onclick="toggleMenu()" class="text-gray-500 hover:text-red-500"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="p-6 space-y-8 flex-1 overflow-y-auto">
                <!-- Theme Switcher -->
                <div>
                    <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4">Appearance</h3>
                    <div class="flex gap-2 p-1 bg-gray-100 dark:bg-gray-800 rounded-lg">
                        <button onclick="setTheme('light')" class="flex-1 py-2 rounded-md text-sm font-medium transition-all theme-btn" data-theme="light">
                            <i class="fas fa-sun mr-1"></i> Light
                        </button>
                        <button onclick="setTheme('dark')" class="flex-1 py-2 rounded-md text-sm font-medium transition-all theme-btn" data-theme="dark">
                            <i class="fas fa-moon mr-1"></i> Dark
                        </button>
                        <button onclick="setTheme('system')" class="flex-1 py-2 rounded-md text-sm font-medium transition-all theme-btn" data-theme="system">
                            <i class="fas fa-laptop mr-1"></i> Auto
                        </button>
                    </div>
                </div>

                <!-- API Settings (Mock) -->
                <div>
                    <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4">Configuration</h3>
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-gray-700 dark:text-gray-300 text-sm">Turbo Mode</span>
                        <div class="w-10 h-5 bg-green-500 rounded-full relative">
                            <div class="absolute right-1 top-1 w-3 h-3 bg-white rounded-full"></div>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Connected to: <span class="text-green-500">Google Gemini Flash</span></p>
                </div>

                <!-- About Section -->
                <div class="mt-auto border-t border-gray-200 dark:border-gray-800 pt-6">
                    <button onclick="openAboutModal()" class="w-full py-3 rounded-xl bg-gradient-to-r from-purple-500/10 to-pink-500/10 text-purple-600 dark:text-purple-400 font-semibold border border-purple-500/20 hover:bg-purple-500/20 transition-all flex items-center justify-center gap-2">
                        <i class="fas fa-info-circle"></i> About Developer
                    </button>
                </div>
            </div>
        </div>

        <!-- ABOUT MODAL -->
        <div id="aboutModal" class="absolute inset-0 z-[60] hidden flex items-center justify-center p-4">
            <div class="absolute inset-0 bg-black/80 backdrop-blur-md" onclick="closeAboutModal()"></div>
            <div class="relative bg-white dark:bg-[#1a1a2e] rounded-3xl p-8 max-w-sm w-full shadow-2xl border border-white/10 transform scale-95 opacity-0 transition-all duration-300" id="aboutContent">
                <button onclick="closeAboutModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
                
                <div class="text-center">
                    <div class="w-20 h-20 mx-auto bg-gradient-to-tr from-cyan-500 to-purple-600 rounded-full p-[2px] mb-4 animate-spin-slow">
                        <div class="w-full h-full bg-white dark:bg-[#1a1a2e] rounded-full flex items-center justify-center overflow-hidden">
                            <i class="fas fa-code text-3xl text-gray-700 dark:text-white"></i>
                        </div>
                    </div>
                    
                    <h3 class="text-gray-500 dark:text-gray-400 text-sm mb-1">Developed by</h3>
                    <h2 class="text-3xl font-bold shiny-text mb-4">Junaed Somrat</h2>
                    
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-6 leading-relaxed">
                        Hey dear user! You can generate unlimited free photos from here. We provide the best quality to improve your production!
                    </p>

                    <div class="flex justify-center gap-4">
                        <a href="#" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-700 dark:text-white hover:bg-blue-500 hover:text-white transition-colors"><i class="fab fa-github"></i></a>
                        <a href="#" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-700 dark:text-white hover:bg-blue-400 hover:text-white transition-colors"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-700 dark:text-white hover:bg-pink-500 hover:text-white transition-colors"><i class="fab fa-instagram"></i></a>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <p class="text-xs text-gray-400">Version 2.0.1 â€¢ LimitlessPix Inc.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAIN SCROLLABLE CONTENT -->
        <div class="flex-1 overflow-y-auto px-5 pb-24 custom-scrollbar relative z-10 scroll-smooth">
            
            <!-- Hero Text -->
            <div class="mb-6 mt-2">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-1">Dream it.</h2>
                <h2 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500">Visualize it.</h2>
            </div>

            <!-- Input Section -->
            <div class="glass-panel rounded-2xl p-1 mb-4 shadow-lg transition-all duration-300 focus-within:ring-2 focus-within:ring-purple-500/50">
                <textarea 
                    id="promptInput"
                    placeholder="Describe your imagination..." 
                    class="w-full bg-transparent text-gray-800 dark:text-white p-4 h-28 resize-none outline-none placeholder-gray-400 text-base rounded-xl"
                ></textarea>
                
                <!-- Tools Bar inside input -->
                <div class="flex justify-between items-center px-3 pb-2">
                    <div class="flex items-center gap-3">
                        <!-- Auto Prompt Toggle -->
                        <div class="flex items-center gap-2 cursor-pointer group" onclick="toggleAutoPrompt()">
                            <div class="w-8 h-4 bg-gray-300 dark:bg-gray-700 rounded-full relative transition-colors duration-300" id="autoPromptTrack">
                                <div class="w-4 h-4 bg-white rounded-full shadow-md absolute left-0 transition-transform duration-300 transform scale-110" id="autoPromptKnob"></div>
                            </div>
                            <span class="text-xs font-semibold text-gray-500 dark:text-gray-400 group-hover:text-purple-400 transition-colors"><i class="fas fa-wand-magic-sparkles mr-1"></i>AI Enhance</span>
                        </div>
                    </div>
                    <span class="text-xs text-gray-400" id="charCount">0/1000</span>
                </div>
            </div>

            <!-- Generate Button -->
            <button 
                onclick="generateImage()" 
                id="generateBtn"
                class="w-full py-4 rounded-xl font-bold text-white shadow-lg shadow-purple-500/30 transform active:scale-[0.98] transition-all duration-200 neon-button mb-8 flex items-center justify-center gap-2 group relative overflow-hidden"
            >
                <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                <i class="fas fa-bolt group-hover:animate-pulse z-10"></i>
                <span class="z-10 tracking-wider">GENERATE MASTERPIECE</span>
            </button>

            <!-- Loading State -->
            <div id="loadingIndicator" class="hidden flex-col items-center justify-center py-8 space-y-4">
                <div class="relative w-16 h-16">
                    <div class="absolute inset-0 rounded-full border-4 border-gray-200 dark:border-gray-800"></div>
                    <div class="absolute inset-0 rounded-full border-4 border-t-purple-500 border-r-transparent border-b-transparent border-l-transparent animate-spin"></div>
                    <div class="absolute inset-2 rounded-full border-4 border-t-cyan-400 border-r-transparent border-b-transparent border-l-transparent animate-spin-slow"></div>
                </div>
                <div class="text-center">
                    <p class="text-gray-800 dark:text-white font-medium animate-pulse">Creating Magic...</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="loadingStep">Analyzing prompt geometry...</p>
                </div>
            </div>

            <!-- Recent Generations Label -->
            <div class="flex items-center gap-2 mb-4 opacity-80" id="galleryHeader">
                <i class="fas fa-clock text-gray-400"></i>
                <span class="text-sm font-semibold text-gray-600 dark:text-gray-300">Recent Creations</span>
            </div>

            <!-- Gallery Grid -->
            <div id="galleryGrid" class="grid grid-cols-2 gap-3 pb-4">
                <!-- Javascript will populate this -->
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="text-center py-12 opacity-60 flex flex-col items-center">
                <div class="w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-image text-3xl text-gray-400"></i>
                </div>
                <h3 class="text-gray-800 dark:text-white font-semibold">No photos yet</h3>
                <p class="text-sm text-gray-500 max-w-[200px]">Type a prompt and let AI paint your imagination.</p>
            </div>
        </div>

        <!-- Bottom Gradient Fade for scrolling feel -->
        <div class="absolute bottom-0 left-0 w-full h-12 bg-gradient-to-t from-white dark:from-[#0a0a16] to-transparent pointer-events-none z-20"></div>

    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-10 left-1/2 transform -translate-x-1/2 bg-white dark:bg-slate-800 text-gray-800 dark:text-white px-6 py-3 rounded-full shadow-2xl -translate-y-32 opacity-0 transition-all duration-500 z-[100] flex items-center gap-3 border border-gray-200 dark:border-slate-700 min-w-[200px]">
        <div class="w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0">
            <i class="fas fa-check text-green-500 text-xs"></i>
        </div>
        <span id="toastMsg" class="text-sm font-medium">Action successful</span>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION & STATE
        // ==========================================
        
        // Key Pool Architecture (For future expansion)
        const keyPool = [
            "", // The environment injects the key here automatically
            // Add more keys here if you have them: "AIzaSy...", "AIzaSy..."
        ];
        let currentKeyIndex = 0;

        // Returns current key, rotates if needed (logic placeholder)
        function getApiKey() {
            return keyPool[currentKeyIndex];
        }

        let isGenerating = false;
        let isAutoPromptOn = false;
        
        // ==========================================
        // DOM ELEMENTS
        // ==========================================
        const promptInput = document.getElementById('promptInput');
        const generateBtn = document.getElementById('generateBtn');
        const galleryGrid = document.getElementById('galleryGrid');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const emptyState = document.getElementById('emptyState');
        const galleryHeader = document.getElementById('galleryHeader');
        const charCount = document.getElementById('charCount');
        const loadingStep = document.getElementById('loadingStep');
        
        // ==========================================
        // INITIALIZATION
        // ==========================================
        window.onload = function() {
            // 1. Theme Init
            initTheme();
            
            // 2. Complex Loader Sequence
            runInitialLoader();

            // 3. Setup Listeners
            setupInputListeners();
        };

        function runInitialLoader() {
            const loaderText = document.getElementById('loaderText');
            const loader = document.getElementById('initialLoader');
            
            const steps = [
                "Initializing Core Systems...",
                "Loading Neural Models...",
                "Connecting to GPU Cluster...",
                "Optimizing Creative Engines...",
                "System Ready."
            ];

            let stepIndex = 0;
            const interval = setInterval(() => {
                if(stepIndex < steps.length) {
                    loaderText.innerText = steps[stepIndex];
                    stepIndex++;
                } else {
                    clearInterval(interval);
                    // Fade out
                    loader.style.opacity = '0';
                    loader.style.visibility = 'hidden';
                }
            }, 600); // Fast sequence
        }

        // ==========================================
        // THEME HANDLING
        // ==========================================
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                setTheme('dark');
            } else {
                setTheme('light');
            }
        }

        function setTheme(mode) {
            const html = document.documentElement;
            const buttons = document.querySelectorAll('.theme-btn');
            
            // Reset buttons
            buttons.forEach(btn => {
                btn.classList.remove('bg-purple-500', 'text-white');
                btn.classList.add('text-gray-600', 'dark:text-gray-300');
            });

            // Activate specific button
            const activeBtn = document.querySelector(`[data-theme="${mode}"]`);
            if(activeBtn) {
                activeBtn.classList.add('bg-purple-500', 'text-white');
                activeBtn.classList.remove('text-gray-600', 'dark:text-gray-300');
            }

            if (mode === 'dark') {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            } else if (mode === 'light') {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                // System
                localStorage.removeItem('theme');
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    html.classList.add('dark');
                } else {
                    html.classList.remove('dark');
                }
            }
        }

        // ==========================================
        // UI INTERACTIONS
        // ==========================================
        function toggleMenu() {
            const menu = document.getElementById('sideMenu');
            const overlay = document.getElementById('menuOverlay');
            
            if (menu.classList.contains('translate-x-full')) {
                // Open
                menu.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
            } else {
                // Close
                menu.classList.add('translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }

        function openAboutModal() {
            toggleMenu(); // Close side menu
            const modal = document.getElementById('aboutModal');
            const content = document.getElementById('aboutContent');
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 50);
        }

        function closeAboutModal() {
            const modal = document.getElementById('aboutModal');
            const content = document.getElementById('aboutContent');
            
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function toggleAutoPrompt() {
            isAutoPromptOn = !isAutoPromptOn;
            const track = document.getElementById('autoPromptTrack');
            const knob = document.getElementById('autoPromptKnob');
            
            if (isAutoPromptOn) {
                track.classList.remove('bg-gray-300', 'dark:bg-gray-700');
                track.classList.add('bg-purple-500');
                knob.classList.add('translate-x-4');
                showToast("Auto Enhance Enabled");
            } else {
                track.classList.add('bg-gray-300', 'dark:bg-gray-700');
                track.classList.remove('bg-purple-500');
                knob.classList.remove('translate-x-4');
                showToast("Auto Enhance Disabled");
            }
        }

        function setupInputListeners() {
            promptInput.addEventListener('input', (e) => {
                charCount.innerText = `${e.target.value.length}/1000`;
            });
            
            promptInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    generateImage();
                }
            });
        }

        // ==========================================
        // CORE GENERATION LOGIC
        // ==========================================
        async function generateImage() {
            let prompt = promptInput.value.trim();
            
            if (!prompt) {
                showToast("Please enter a prompt first!", true);
                promptInput.focus();
                return;
            }

            if (isGenerating) return;

            // Apply Auto Prompt Logic
            if (isAutoPromptOn) {
                const enhancements = ", highly detailed, 8k resolution, cinematic lighting, photorealistic, masterpiece, vivid colors, sharp focus, professional photography";
                prompt += enhancements;
            }

            // Start UI Loading State
            isGenerating = true;
            generateBtn.disabled = true;
            generateBtn.classList.add('opacity-75', 'cursor-not-allowed');
            loadingIndicator.classList.remove('hidden');
            loadingIndicator.classList.add('flex');
            galleryGrid.classList.add('opacity-50');
            
            // Scroll to loader
            loadingIndicator.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            // Animate Loading Text
            const loadingMessages = [
                "Interpreting prompt...",
                "Mixing colors...",
                "Calculating lighting...",
                "Rendering pixels...",
                "Finalizing details..."
            ];
            let msgIdx = 0;
            const msgInterval = setInterval(() => {
                loadingStep.innerText = loadingMessages[msgIdx % loadingMessages.length];
                msgIdx++;
            }, 1500);

            try {
                const apiKey = getApiKey();
                // Use Imagen 4 (or best available in environment)
                const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        instances: [{ prompt: prompt }],
                        parameters: {
                            sampleCount: 1,
                            aspectRatio: "1:1"
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Generation failed');
                }

                const result = await response.json();
                const base64Image = result.predictions[0].bytesBase64Encoded;
                const imageUrl = `data:image/png;base64,${base64Image}`;

                // Success
                addImageToGallery(imageUrl, promptInput.value.trim()); // Use original prompt for display
                showToast("Masterpiece Generated!");
                promptInput.value = "";
                charCount.innerText = "0/1000";

            } catch (error) {
                console.error("Gen Error:", error);
                showToast("Failed to generate. Try again.", true);
            } finally {
                // Reset UI
                clearInterval(msgInterval);
                isGenerating = false;
                generateBtn.disabled = false;
                generateBtn.classList.remove('opacity-75', 'cursor-not-allowed');
                loadingIndicator.classList.add('hidden');
                loadingIndicator.classList.remove('flex');
                galleryGrid.classList.remove('opacity-50');
            }
        }

        // ==========================================
        // GALLERY & DOWNLOAD LOGIC
        // ==========================================
        function addImageToGallery(url, promptText) {
            emptyState.classList.add('hidden');
            galleryHeader.classList.remove('hidden');

            const card = document.createElement('div');
            card.className = "relative group aspect-square rounded-xl overflow-hidden bg-gray-100 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 animate-fade-in";
            
            card.innerHTML = `
                <img src="${url}" alt="${promptText}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-3">
                    <p class="text-white text-xs line-clamp-2 mb-2 font-medium">${promptText}</p>
                    <button onclick="downloadImage(this, '${promptText.replace(/'/g, "")}')" class="w-full py-2 bg-white/20 backdrop-blur-md border border-white/30 rounded-lg text-white text-xs font-bold hover:bg-white hover:text-black transition-all flex items-center justify-center gap-2">
                        <i class="fas fa-download"></i> SAVE HD
                    </button>
                </div>
            `;

            galleryGrid.prepend(card);
        }

        function downloadImage(btn, prompt) {
            const card = btn.closest('div.relative');
            const img = card.parentElement.querySelector('img');
            
            const link = document.createElement('a');
            link.href = img.src; // This is the full base64 string (High Quality)
            const safeName = prompt.substring(0, 20).replace(/[^a-z0-9]/gi, '_').toLowerCase();
            link.download = `limitlesspix_${safeName}_${Date.now()}.png`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast("Downloading High Quality...");
        }

        // ==========================================
        // UTILS
        // ==========================================
        function showToast(msg, isError = false) {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toastMsg');
            const icon = toast.querySelector('div');
            
            toastMsg.innerText = msg;
            
            if (isError) {
                icon.className = "w-6 h-6 rounded-full bg-red-500/20 flex items-center justify-center flex-shrink-0";
                icon.innerHTML = '<i class="fas fa-exclamation text-red-500 text-xs"></i>';
            } else {
                icon.className = "w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0";
                icon.innerHTML = '<i class="fas fa-check text-green-500 text-xs"></i>';
            }

            toast.classList.remove('-translate-y-32', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-100');

            setTimeout(() => {
                toast.classList.remove('translate-y-0', 'opacity-100');
                toast.classList.add('-translate-y-32', 'opacity-0');
            }, 3000);
        }

        // Add extra CSS for Fade In animation
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .animate-fade-in {
                animation: fadeIn 0.5s ease-out forwards;
            }
        `;
        document.head.appendChild(style);

    </script>
</body>
</html>

